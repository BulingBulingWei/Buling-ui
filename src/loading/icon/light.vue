<template>
  <svg :width="size" :height="size" viewBox="0 0 38 70">
    <mask :id="id">
      <rect x="0" :y="status" width="38" height="70" fill="#fff">
        <!-- animate参数详解：
          attributeName="y"
          values="70;0" //定义一系列动画的中间值，<animate> 会依次在这些值之间插值过渡。
          begin="indefinite"
          dur="1.2s" //动画持续时间
          calcMode="spline" //使用贝塞尔曲线插值，需配合 keySplines
          keySplines="0.42 0 0.58 1" //定义每段动画的缓动曲线，值是贝塞尔曲线的控制点，格式为 x1,y1,x2,y2。
          repeatCount="indefinite" //无限循环
          restart="indefinite" 
          -->
        <animate
          ref="animateRef"
          attributeName="y"
          values="70;0"
          begin="indefinite"
          dur="1.2s"
          calcMode="spline"
          keySplines="0.42 0 0.58 1"
          repeatCount="indefinite"
          restart="indefinite"
        />
      </rect>
    </mask>
    <path
      d="M12.5946197,2.11503026 L33.548338,0.341602536 C34.7753702,0.237752096 35.8542637,1.14827079 35.9581142,2.37530296 C35.9937274,2.79608726 35.9091141,3.2183336 35.7141203,3.59290688 L24.8001399,24.5581119 C24.3939873,25.3383105 24.6972116,26.3000382 25.4774102,26.7061908 C25.728616,26.8369625 26.010149,26.8983842 26.2929959,26.8841262 L35.5609216,26.4169376 C36.790779,26.3549415 37.8380333,27.3016802 37.9000294,28.5315376 C37.9242166,29.0113555 37.7927786,29.4861525 37.5252882,29.8852253 L11.2891226,69.0273356 C10.7993905,69.7579739 9.81008482,69.953267 9.07944653,69.4635349 C8.53583672,69.0991642 8.27045504,68.4393393 8.41039118,67.8000464 L13.1394037,46.1957328 C13.3274847,45.3364917 12.783402,44.4874693 11.9241608,44.2993882 C11.7767799,44.2671277 11.6255628,44.2559725 11.4750433,44.266257 L3.0484193,44.8420236 C1.81986473,44.9259672 0.75587478,43.9980766 0.671931238,42.769522 C0.656193486,42.5391924 0.676323266,42.3078158 0.731600892,42.0836644 L10.053036,4.28515387 C10.3473538,3.09169236 11.3697822,2.21869495 12.5946197,2.11503026 Z"
      :class="name"
      :mask="`url(#${id})`"
    ></path>
    <path
      d="M12.5946197,2.11503026 L33.548338,0.341602536 C34.7753702,0.237752096 35.8542637,1.14827079 35.9581142,2.37530296 C35.9937274,2.79608726 35.9091141,3.2183336 35.7141203,3.59290688 L24.8001399,24.5581119 C24.3939873,25.3383105 24.6972116,26.3000382 25.4774102,26.7061908 C25.728616,26.8369625 26.010149,26.8983842 26.2929959,26.8841262 L35.5609216,26.4169376 C36.790779,26.3549415 37.8380333,27.3016802 37.9000294,28.5315376 C37.9242166,29.0113555 37.7927786,29.4861525 37.5252882,29.8852253 L11.2891226,69.0273356 C10.7993905,69.7579739 9.81008482,69.953267 9.07944653,69.4635349 C8.53583672,69.0991642 8.27045504,68.4393393 8.41039118,67.8000464 L13.1394037,46.1957328 C13.3274847,45.3364917 12.783402,44.4874693 11.9241608,44.2993882 C11.7767799,44.2671277 11.6255628,44.2559725 11.4750433,44.266257 L3.0484193,44.8420236 C1.81986473,44.9259672 0.75587478,43.9980766 0.671931238,42.769522 C0.656193486,42.5391924 0.676323266,42.3078158 0.731600892,42.0836644 L10.053036,4.28515387 C10.3473538,3.09169236 11.3697822,2.21869495 12.5946197,2.11503026 Z"
      :class="`${name}-bg`"
    ></path>
  </svg>
</template>
<script lang="ts" setup>
import { ref, nextTick, watch } from 'vue'
import { nanoid } from 'nanoid'
import config from '@/config'
import { computed } from 'vue'
const name = `${config.prefix}-loading-icon-light`
const id = nanoid(8)
const animateRef = ref()

const props = defineProps({
  autoplay: Boolean,
  size: {
    type: String,
    default: '0.7rem'
  },
  percent: {
    type: Number,
    default: 100
  }
})

const status = computed(() => ((100 - props.percent) * 70) / 100)

const restart = () => {
  nextTick(() => {
    animateRef?.value?.beginElement()
  })
}

const restore = () => {
  nextTick(() => {
    animateRef?.value?.endElement()
  })
}

watch(animateRef, () => {
  if (props.autoplay && animateRef.value) {
    restart()
  }
})

defineExpose({
  restart,
  restore
})
</script>
